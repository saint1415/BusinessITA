<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Business ITA - Incident Template Assistant</title>
  <link rel="icon" href="assets/icons/business-ita.svg" />
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>

  <header class="app-header">
    <div class="brand">
      <img src="assets/icons/business-ita.svg" alt="Business ITA Logo" class="logo" />
      <div>
        <h1>Business ITA</h1>
        <p class="subtitle">Incident Template Assistant</p>
      </div>
    </div>
    <div class="header-actions">
      <button id="themeToggle" class="btn" aria-label="Toggle theme">ðŸŒ™</button>

      <details class="dropdown">
        <summary class="btn">File</summary>
        <div class="menu">
          <button id="saveRevision" class="btn">Save Revision</button>
          <label class="file-btn">
            <input type="file" id="uploadIncident" accept=".json" />
            <span class="btn">Open Incident (.json)</span>
          </label>
        </div>
      </details>
      
      <details class="dropdown">
        <summary class="btn">Download</summary>
        <div class="menu">
          <button id="downloadIncident" class="btn">Download Incident (.json)</button>
          <button id="downloadBundle" class="btn">Download Bundle (.txt)</button>
        </div>
      </details>
      
      <button id="generateId" class="btn primary">Generate New ID</button>
    </div>
  </header>

  <main class="app-main">
    
    <aside class="sidebar">
      <div class="panel">
        <h3>Templates</h3>
        <div class="field">
          <label>Filter by Audience</label>
          <select id="templateAudienceFilter">
            <option value="">All audiences</option>
            <option value="internal">Internal</option>
            <option value="executive">Executive</option>
            <option value="customers">Customers</option>
            <option value="regulators">Regulators</option>
            <option value="media">Media</option>
            <option value="support">Support</option>
          </select>
        </div>
        <div class="field">
          <label>Filter by Severity</label>
          <select id="templateSeverityFilter">
            <option value="">All severities</option>
            <option>S0</option><option>S1</option><option>S2</option><option>S3</option>
          </select>
        </div>
        <ul id="templateList" class="template-list">
          </ul>
        <label class="file-btn">
            <input type="file" id="uploadTemplate" accept=".json,.md" />
            <span class="btn" style="width: 100%;">Add Custom Template</span>
        </label>
      </div>
    </aside>

    <section class="editor-pane">
      <div class="panel">
        <h3>Incident Details</h3>
        <fieldset>
          <div class="field-grid">
            <div class="field">
              <label for="incidentId">Incident ID</label>
              <input id="incidentId" placeholder="YYYYMM_NN or YYYYMM_NN.RR" />
            </div>
            <div class="field">
              <label for="ticketId">Ticket ID</label>
              <input id="ticketId" placeholder="INC-1234 / JIRA-5678" />
            </div>
          </div>
          <div class="field">
            <label for="incidentName">Name</label>
            <input id="incidentName" placeholder="e.g., Payment Processing Degradation" />
          </div>
        </fieldset>
      </div>

      <div class="panel">
        <h3>Timeline & Severity</h3>
        <fieldset>
          <div class="field-grid">
            <div class="field">
              <label for="startTime">Start Time (Local)</label>
              <input id="startTime" type="datetime-local" />
            </div>
            <div class="field">
              <label for="nextUpdateTime">Next Update (Local)</label>
              <input id="nextUpdateTime" type="time" />
            </div>
          </div>
          <div class="field-grid">
            <div class="field">
              <label for="incidentSeverity">Severity</label>
              <select id="incidentSeverity">
                <option value="">Select Severity</option>
                <option>S0</option><option>S1</option><option>S2</option><option>S3</option>
              </select>
            </div>
            <div class="field">
              <label for="eta">ETA for Resolution</label>
              <input id="eta" placeholder="e.g., 45 minutes" />
            </div>
          </div>
        </fieldset>
      </div>

      <div class="panel">
        <h3>Impact & Status</h3>
        <fieldset>
           <div class="field">
              <label for="impactSummary">Impact Summary</label>
              <textarea id="impactSummary" rows="3" placeholder="Brief, user-facing description of the effect"></textarea>
            </div>
            <div class="field-grid">
              <div class="field">
                <label for="customersAffected">Customers Affected</label>
                <input id="customersAffected" placeholder="e.g., 18% of EU traffic" />
              </div>
              <div class="field">
                <label for="dollarImpactPerHour">$ Impact / hr (est.)</label>
                <input id="dollarImpactPerHour" type="number" min="0" step="100" />
              </div>
            </div>
            <div class="field">
              <label for="currentStatus">Current Status</label>
              <input id="currentStatus" placeholder="e.g., Investigating, Identified, Monitoring" />
            </div>
            <div class="field">
              <label for="rootCauseStatus">Root Cause Status</label>
              <input id="rootCauseStatus" placeholder="e.g., Hypothesis, Cause identified" />
            </div>
        </fieldset>
      </div>
      
      <div class="panel">
        <h3>Stakeholders & Links</h3>
        <fieldset>
          <div class="field-grid">
            <div class="field">
              <label for="icName">Incident Commander (IC)</label>
              <input id="icName" />
            </div>
            <div class="field">
              <label for="contact">Contact Point</label>
              <input id="contact" placeholder="incidents@company.com" />
            </div>
          </div>
          <div class="field-grid">
            <div class="field">
              <label for="jurisdiction">Jurisdiction</label>
              <select id="jurisdiction">
                <option value="global">Global</option>
                <option value="EU">EU (GDPR)</option>
                <option value="US">US</option>
                <option value="SEC">US (SEC)</option>
              </select>
            </div>
            <div class="field">
              <label for="linkStatusPage">Status Page URL</label>
              <input id="linkStatusPage" placeholder="https://status.company.com" />
            </div>
          </div>
        </fieldset>
      </div>

      <div class="panel">
        <h3>Communications Generator</h3>
        <div class="field">
          <label for="audienceSelect">Select Audience(s)</label>
          <select id="audienceSelect" multiple size="6">
            <option value="internal">Internal Responders</option>
            <option value="executive">Executives/Leadership</option>
            <option value="customers">Customers</option>
            <option value="regulators">Regulators/Authorities</option>
            <option value="media">Media/PR</option>
            <option value="support">Support</option>
          </select>
        </div>
        <button id="generateComms" class="btn primary">Generate Communications</button>
      </div>
    </section>

    <section class="preview-pane">
      <div class="panel">
        <h3>Selected Template Editor</h3>
        <div id="selectedTemplateMeta" class="meta"></div>
        <textarea id="templateRaw" rows="10" spellcheck="false" placeholder="Select a template from the list to view its raw content here..."></textarea>
        <button id="applyTemplate" class="btn">Apply Changes</button>
      </div>
      
      <div class="panel">
        <h3>Detected Tokens</h3>
        <form id="tokenForm" class="token-form">
          </form>
      </div>

      <div class="panel">
        <h3>Rendered Communication</h3>
        <div class="toolbar">
          <button id="copyRendered" class="btn">Copy</button>
        </div>
        <pre id="renderedText" class="rendered"></pre>
      </div>

      <div class="panel">
        <h3>Print Preview</h3>
        <div class="toolbar">
          <button onclick="window.print()" class="btn">Print to PDF</button>
        </div>
        <article id="printPreview" class="preview"></article>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <span>Business ITA â€¢ Runs offline in evergreen browsers</span>
  </footer>

  <div id="toastContainer"></div>

  <script src="assets/js/templates.js"></script>
  <script src="assets/js/store.js"></script>
  <script src="assets/js/render.js"></script>
  <script src="assets/js/parser.js"></script>
  <script src="assets/js/ui.js"></script>
  <script src="assets/js/app.js"></script>
</body>
</html>
